#!/bin/bash

# Project: Terraform build of a Pentesting Infrastructure
# Author:  Daemonchild
# Purpose: Build an environment for running pentests

#    __ _ _____   _ _ __ ___ 
#   / _` |_  / | | | '__/ _ \
#  | (_| |/ /| |_| | | |  __/
#   \__,_/___|\__,_|_|  \___|   Version
   
# Setup Script - Linux Server - Bash

scriptsource="https://raw.githubusercontent.com/daemonchild/pentest-environment-azure/main/buildscripts/"

sudo apt-get -y update 
sudo apt-get -y upgrade
sudo apt-get install -y mysql-client

# Get MySQL Data
wget -q "${scriptsource}/setup.sql"      -O  /tmp/setup.sql
wget -q "${scriptsource}/guacinitdb.sql" -O  /tmp/guacinitdb.sql

mysql -h MYSQLSERVERNAME.mysql.database.azure.com -u ADMINUSER@MYSQLSERVERNAME guacamoledb --password=$DBPASS < setup.sql
mysql -h MYSQLSERVERNAME.mysql.database.azure.com -u ADMINUSER@MYSQLSERVERNAME guacamoledb --password=$DBPASS < guacinitdb.sql